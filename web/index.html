<!DOCTYPE html>
<!-- creds to Thaddius777 on deviant art for the splashscreen background-->

<html lang="en">
<head>
    <title>H2OhSh!t</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- Compatibility? -->
        <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>-->
        
        <!-- Normalize -->
        <link href="css/normalize.css" rel="stylesheet">
        
        <!-- Bootstrap -->
        <link href="css/bootstrap.css" rel="stylesheet">
        <script src="js/bootstrap.min.js" type="text/javascript"></script>
        <link href="css/metro-bootstrap.css" rel="stylesheet">
        <script src="js/metro.min.js" type="text/javascript"></script>
        
        <!-- Pure -->
        <link href="css/pure.css">
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-old-ie-min.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
        <link href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css" rel="stylesheet">
        <!--<![endif]-->
        
        <!-- Font-Awesome -->
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
        
		<!-- JS -->		
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>		
        <script src="js/jquery.typer.js"></script>
        
        <!-- <script src="js/parse-1.2.18.min.js"></script> -->
        <!-- <script src="js/Counter.js"></script> -->
        
        <!-- Slicknav -->
        <link href="css/slicknav.css">
        <script src="js/jquery.slicknav.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
        
        <!-- Monomo -->
        <link href="css/monomo.css" rel="stylesheet">
        
        <script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
        <script type="text/javascript" src="js/jquery.plusanchor.js"></script>
        <script type="text/javascript">
            //Readies the function
            $(document).ready(function(){
                $('body').plusAnchor({
                    easing: 'easeInOutExpo',
                    speed:  1000
                });
            });
        </script>
        <!-- Styling for the map -->
        <style type="text/css">
            svg {
                background: #fff;
            }

            #india {
                fill: lightgrey;
                opacity: .8;
                stroke: white ;
                stroke-width: .7;
            }
        </style>
        
        
        <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.10/jquery-ui.js" type="text/javascript"></script>
    <link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.10/themes/redmond/jquery-ui.css" rel="stylesheet" type="text/css" />
       
       
        <style type="text/css">
        .ui-autocomplete-loading
        {
            background: white url('images/ui-anim_basic_16x16.gif') right center no-repeat;
        }
        #searchBox
        {
            width: 25em;
        }
    </style>
    <script type="text/javascript" src="http://code.jquerygeo.com/jquery.geo-1.0b1.min.js"></script>

    <script type="text/javascript">
        
        $(document).ready(function () {
            getLoc();
            $("#searchBox").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: "http://dev.virtualearth.net/REST/v1/Locations",
                        dataType: "jsonp",
                        data: {
                            key: "Av82i_sVoOskWa8zD-NAxVNI6aXi4-QbbMl4xoWBFQ35Mpwc8q-DzL4ObG9AskAv",
                            q: request.term
                        },
                        jsonp: "jsonp",
                        success: function (data) {
                            var result = data.resourceSets[0];
                            if (result) {
                                if (result.estimatedTotal > 0) {
                                    response($.map(result.resources, function (item) {
                                        return {
                                            data: item,
                                            label: item.name + ' (' + item.address.countryRegion + ')',
                                            value: item.name
                                        }
                                    }));
                                }
                            }
                        }
                    });
                },
                minLength: 1,
                change: function (event, ui) {
                    if (!ui.item)
                    {
                        $("#searchBox").val('');
                        $("#searchBox").css("background-color", "rgba(230, 230, 230, 0.5)");
                    }
                },
                select: function (event, ui) {
                    displaySelectedItem(ui.item.data);
                }
            });
        });

        function displaySelectedItem(item) {
            
            $("#searchBox").val(item.name + '(' + item.address.countryRegion + ')');
            /*- ' + item.point.coordinates[0] + ', ' + item.point.coordinates[1]);*/
            /*
            $("#searchResult").empty().append('Result: ' + item.name).append(' (Latitude: ' + item.point.coordinates[0] + ' Longitude: ' + item.point.coordinates[1] + ')');*/
        }
    </script>
    
</head>
<body>
   <div id="landing" class="mo-intro">      
       <div class="container">
           <div class="content">
               <h1 class="title">Potable</h1>
               <h2>Clean Water. Crowd Sourced.</h2>
               <button class="btnClear" onclick="OnPageNavRequest('#landing', '#map')">Explore the Map</button>
               <br><br>
               <a onclick="OnModalPageRequest('#landing', '#map', '#experienceForm')">Or submit your experiences</a>
           </div>
       </div>
   </div>
    <div id="map" class="invisible no-display">
       <div class="submitExperience">
           <a class="btnRed" data-toggle="modal" data-target="#experienceForm">
               <i class="fa fa-plus fa-1x"></i>
               <h6 class="inline">How's your water?</h6>
           </a>
       </div>
       
       <!-- LIAM -->
       <meta charset="utf-8">
<style>
path {
  stroke: white;
  stroke-width: 0.25px;
  fill: grey;
}
    <!-- Colours for the map -->
.q0-9 { fill:rgb(247,251,255); }
.q1-9 { fill:rgb(222,235,247); }
.q2-9 { fill:rgb(198,219,239); }
.q3-9 { fill:rgb(158,202,225); }
.q4-9 { fill:rgb(107,174,214); }
.q5-9 { fill:rgb(66,146,198); }
.q6-9 { fill:rgb(33,113,181); }
.q7-9 { fill:rgb(8,81,156); }
.q8-9 { fill:rgb(8,48,107); }
    
    
svg { cursor:crosshair; }
    
    /*
path { -moz-box-shadow: -5px -5px 5px #000;
            -webkit-box-shadow: -5px -5px 5px #000;
            box-shadow: -5px -5px 5px #000; }   
    */
    
</style>
<script src="d3.v3.min.js"></script>
<script src="topojson.v0.min.js"></script>
<script>
    //Sets the width and height for the map
var width = 960,
    height = 500;
    
    //Sets the projection type for the map (mercator projection)
var projection = d3.geo.mercator()
    .center([0, 5 ])
    .scale(200)
    .rotate([-180,0]);

    
    //Adds and SVG to the body
var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

    
//Creates a path
var path = d3.geo.path()
    .projection(projection);

    //Appends the g to the svg
var g = svg.append("g");
    
    //Sets a linear scale type to be used for coloration
var scale =  d3.scale.linear()
        .domain([1,2,3,4,5])
        .range("#3D5AFE","#00C853","#AFB42B","#FF8F00","#D50000");


// load and display the World
d3.json("world.json", function(error, topology) {
    
    $.ajax({
        url: "/api/data",
        type: "GET",
        dataType: "json",
    }).done(function(data) {
    /// })

// load and display the water quality nodes
// d3.csv("csv/water.csv", function(error, data) {
  console.dir(data);
    g.selectAll("circle")
       .data(data)
       .enter()
//       .append("a")
//				  .attr("xlink:href", function(d) {
//					  return "https://www.google.com/search?q="+d.city;}
//				  )
    //We append a circle
       .append("circle")
       .attr("cx", function(d) {
        //Place is on the proper spot on the d3 projection
        console.dir(d);
               return projection([d.lon, d.lat])[0];
       })
       .attr("cy", function(d) {
               return projection([d.lon, d.lat])[1];
       })
       .attr("r",  function(d){ 
                return (d.complaints) * 0.03;
        })
    //Style it up
    .style("fill", "#000") // function(d){
//            return scale(d);   
//    })
    .style("fill-opacity","0")
    .style("stroke-width","1")
       .style("stroke","rgba(200, 54, 54, 0.5)");
});


g.selectAll("path")
      .data(topojson.object(topology, topology.objects.countries)
          .geometries)
    .enter()
      .append("path")
      .attr("d", path)
});

// zoom and pan
var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+ 
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")  
            .attr("d", path.projection(projection)); 

  });

svg.call(zoom)

</script>

    </div>
   
    <div id="experienceForm" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title glober">Your Experience</h4>
                </div>
                <div class="modal-body">
                <form role="form" class="">
                        <div class="form-group">
                            <label for="inputFirstName">&nbsp;Location</label>
                            <input id="searchBox" type="text" class="form-text-input" id="inputFirstName" placeholder="New York, NY, United States">
                            <a class="btnRed btnGlobe" onclick="getLoc()"><i class="fa fa-globe"></i></a>
                            <div id="searchResult" class="ui-widget" style="margin-top: 1em;">
        </div>        
                            <label for="waterQ">&nbsp;Water Quality (1 worst, 5 best)</label>
                            <div class="container">
                            <input id="waterQ" type="hidden" class="rating" data-filled="glyphicon glyphicon-heart" data-empty="glyphicon glyphicon-heart-empty" style="margin-left: 250px;"/>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="btnSubmit" type="button" class="btnPurple center" onclick="dataSubmit()">Submit</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <script src="js/page.js"></script>
    <script src="js/bootstrap-rating.min.js"></script>
    <script type="text/javascript">
        /* $(".rating").rating(); */
        function getLoc () {
            $(".nav").buttonset();

        if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (p) {
                getCoords([p.coords.longitude, p.coords.latitude]);
            }, 
            
            function (error) {
                getCoords([p.coords.longitude, p.coords.latitude]);
            });
        } 
        
        else {
            getCoords([p.coords.longitude, p.coords.latitude]);
        }

        function getCoords(center) {
            console.log(center);
        };

        }
  
    </script>
    
    
    
    <script type="text/javascript">
        var w = 600;
        var h = 600;
        var proj = d3.geo.mercator();
        var path = d3.geo.path().projection(proj);
        var t = proj.translate(); // the projection's default translation
        var s = proj.scale(); // the projection's default scale

        var map = d3.select("#chart").append("svg:svg")
            .attr("width", w)
            .attr("height", h)
        //        .call(d3.behavior.zoom().on("zoom", redraw))
        .call(initialize);

        var india = map.append("svg:g")
            .attr("id", "india");



        d3.json("json/indianstates.json", function (json) {
        india.selectAll("path")
            .data(json.features)
            .enter().append("path")
            .attr("d", path);
    });


        function initialize() {
        proj.scale(6700);
        proj.translate([-1240, 720]);
    }


        d3.json("json/water.json", function (json) {

        svg.selectAll("circle")
            .data(json.nodes)
            .enter()
            .append("circle")
            .attr("cx", function (json) {
            return projection([json.lon, json.lat])[0];
        })
            .attr("cy", function (json) {
            return projection([json.lon, json.lat])[1];
        })
            .attr("r", function (json) {
            return (json.complaints);
        })
            .style("fill", "black")
            .style("opacity", 0.75);

    });
  </script>
</body>
</html>